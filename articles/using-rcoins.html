<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tracing continuous streets using rcoins • rcoins</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tracing continuous streets using rcoins">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rcoins</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/using-rcoins.html">Tracing continuous streets using rcoins</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CityRiverSpaces/rcoins/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Tracing continuous streets using rcoins</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CityRiverSpaces/rcoins/blob/main/vignettes/using-rcoins.Rmd" class="external-link"><code>vignettes/using-rcoins.Rmd</code></a></small>
      <div class="d-none name"><code>using-rcoins.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cityriverspaces.github.io/rcoins/">rcoins</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>In this article we demonstrate how to trace continuous streets using
the <code><a href="../reference/stroke.html">stroke()</a></code> function. The function takes an
<code>sf</code> object of streets and returns a new <code>sf</code>
object with continuous streets.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load streets from example OSM data</span></span>
<span><span class="va">bucharest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_example_data.html">get_example_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">streets</span> <span class="op">&lt;-</span> <span class="va">bucharest</span><span class="op">$</span><span class="va">streets</span></span></code></pre></div>
<div class="section level2">
<h2 id="tracing-on-the-entire-network">Tracing on the entire network<a class="anchor" aria-label="anchor" href="#tracing-on-the-entire-network"></a>
</h2>
<p>If we run the <code><a href="../reference/stroke.html">stroke()</a></code> function with the default values,
strokes will be calculated on the network as a whole.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Trace continuous streets</span></span>
<span><span class="va">continuous_streets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stroke.html">stroke</a></span><span class="op">(</span><span class="va">streets</span><span class="op">)</span></span></code></pre></div>
<p>To visualise the strokes in a more intuitive way, we map the line
weight in the plot to the length of the strokes. The thicker a line is,
the longer the stroke.</p>
<p><img src="using-rcoins_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="tracing-from-specified-streets">Tracing from specified streets<a class="anchor" aria-label="anchor" href="#tracing-from-specified-streets"></a>
</h2>
<p>To trace continuous streets from a given set of streets, we can add
the edge indices in the <code>from_edge</code> argument. We demonstrate
this by tracing all continuous streets crossing river Dâmbovița in
Bucharest. We load the river centerline from the example data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load river centerline from example data</span></span>
<span><span class="va">river_centerline</span> <span class="op">&lt;-</span> <span class="va">bucharest</span><span class="op">$</span><span class="va">river_centerline</span></span>
<span></span>
<span><span class="va">crossing_edges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">(</span><span class="va">streets</span>,</span>
<span>                                      <span class="va">river_centerline</span>,</span>
<span>                                      sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Trace continuous streets crossing the river</span></span>
<span><span class="va">continuous_streets_crossing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stroke.html">stroke</a></span><span class="op">(</span><span class="va">streets</span>, from_edge <span class="op">=</span> <span class="va">crossing_edges</span>,</span>
<span>                                      angle_threshold <span class="op">=</span> <span class="fl">120</span><span class="op">)</span></span></code></pre></div>
<p>Note that the input argument <code>angle_threshold</code> sets the
minimum internal angle between consecutive line segments that can be
considered part of a continuous stroke.</p>
<p>We plot the street network and emphasize the continuous streets
crossing the river.</p>
<p><img src="using-rcoins_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="maintaining-the-initial-structure">Maintaining the initial structure<a class="anchor" aria-label="anchor" href="#maintaining-the-initial-structure"></a>
</h2>
<p>The <code>flow_mode</code> argument allows us to maintain the initial
structure of the streets. With <code>flow_mode = FALSE</code> (the
default), the function will split the initial streets in individual line
segments and calculate the continuous streets purely based on minimum
angle deviations. With <code>flow_mode = TRUE</code>, the function will
not break the initial line strings, but only group and connect them on
the basis of minimum angle deviations.</p>
<!-- Question: is there a situation when we want `flow_mode = TRUE` without `attribute_mode = TRUE`? If not, we may want to drop this argument, or at least not present it in the vignette. -->
</div>
<div class="section level2">
<h2 id="tracing-with-attributes">Tracing with attributes<a class="anchor" aria-label="anchor" href="#tracing-with-attributes"></a>
</h2>
<p>By enabling <code>flow_mode</code> and <code>attributes</code>
arguments, <code>stroke</code> will still group streets on the basis of
minimum-angle connectivity, but return group labels instead of the new
aggregated geometries. This is useful if we want to keep attributes such
as degree of the initial streets (“primary”, “secondary”, “tertiary”,
etc.) in the resulting continuous streets to calculate, for instance,
the relationship between street degree and street length.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Francesco Nattino, Claudiu Forgaci, Fakhereh Alidoost, Netherlands eScience Center.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
